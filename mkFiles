#!/bin/bash

#=======================================================================
# $Id$
# Creates Files.md5 and Files.sha1 in current directory.
#=======================================================================

lockname=mkFiles.lock
until mkdir $lockname 2>/dev/null; do
	echo $0: $lockname: Waiting for lock... >&2
	sleep 5
done

echo Creating MD5...
find -type f -print0 | LC_COLLATE=C sort -z | xargs -0 md5sum | grep -v -e '  \./Files\.md5' -e '  \./Files.sha1' >Files.md5
echo Creating SHA1...
find -type f -print0 | LC_COLLATE=C sort -z | xargs -0 sha1sum | grep -v '  \./Files\.sha1' >Files.sha1
echo Done.

rmdir $lockname
