Index: finduuid
===================================================================
--- finduuid	(revisjon 3098)
+++ finduuid	(arbeidskopi)
@@ -28,6 +28,7 @@
     'filenames' => 0,
     'help' => 0,
     'line' => 0,
+    'unique' => 0,
     'verbose' => 0,
     'version' => 0,
 
@@ -49,6 +50,7 @@
     "filenames|f" => \$Opt{'filenames'},
     "help|h" => \$Opt{'help'},
     "line|l" => \$Opt{'line'},
+    "unique|u" => \$Opt{'unique'},
     "verbose|v+" => \$Opt{'verbose'},
     "version" => \$Opt{'version'},
 
@@ -63,15 +65,20 @@
 
 my $Lh = "[0-9a-fA-F]";
 my $Templ = "$Lh\{8}-$Lh\{4}-$Lh\{4}-$Lh\{4}-$Lh\{12}";
+my %uuid_list = ();
 
 while (<>) {
     chomp(my $Line = $_);
     if (/($Templ)/) {
-        if ($Opt{'line'}) {
-            printf("%s%s\n", ($Opt{'filenames'} ? "$ARGV:" : ""), $Line);
-        } else {
-            $Line =~ s/($Templ)/printf("%s%s\n", ($Opt{'filenames'} ? "$ARGV:" : ""), $1)/ge;
+        my $Curr = $1;
+        if (!$Opt{'unique'} || !defined($uuid_list{lc($Curr)})) {
+            if ($Opt{'line'}) {
+                printf("%s%s\n", ($Opt{'filenames'} ? "$ARGV:" : ""), $Line);
+            } else {
+                $Line =~ s/($Templ)/printf("%s%s\n", ($Opt{'filenames'} ? "$ARGV:" : ""), $1)/ge;
+            }
         }
+        $Opt{'unique'} && ($uuid_list{lc($Curr)} = 1);
     }
 }
 
@@ -105,6 +112,8 @@
     Show this help.
   -l, --line
     Print the whole line where UUIDs are found.
+  -u, --unique
+    Print only the first occurence of every uuid.
   -v, --verbose
     Increase level of verbosity. Can be repeated.
   --version
Index: tests/finduuid-files/textfile
===================================================================
--- tests/finduuid-files/textfile	(revisjon 3098)
+++ tests/finduuid-files/textfile	(arbeidskopi)
@@ -5,3 +5,4 @@
 5 dsfv dsf qw weqd
 6 fd5d1200-88da-11dd-b7cf-000475e441b9
 7 i ksjn klasjdnc
+8 once more 9829C1A8-88D5-11DD-9A24-000475E441B9
Index: tests/finduuid.t
===================================================================
--- tests/finduuid.t	(revisjon 3098)
+++ tests/finduuid.t	(arbeidskopi)
@@ -139,6 +139,7 @@
 finduuid-files/std-random:2bd76352-88d5-11dd-8848-000475e441b9
 finduuid-files/textfile:9829c1a8-88d5-11dd-9a24-000475e441b9
 finduuid-files/textfile:fd5d1200-88da-11dd-b7cf-000475e441b9
+finduuid-files/textfile:9829C1A8-88D5-11DD-9A24-000475E441B9
 END
     "",
     "Option --filenames lists file name",
@@ -168,6 +169,7 @@
     <<END,
 4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
 6 fd5d1200-88da-11dd-b7cf-000475e441b9
+8 once more 9829C1A8-88D5-11DD-9A24-000475E441B9
 END
     "",
     "Print whole line with UUID",
@@ -178,6 +180,7 @@
     <<END,
 4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
 6 fd5d1200-88da-11dd-b7cf-000475e441b9
+8 once more 9829C1A8-88D5-11DD-9A24-000475E441B9
 END
     "",
     "Read from stdin and print whole line with UUID",
@@ -188,6 +191,7 @@
     <<END,
 finduuid-files/textfile:4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
 finduuid-files/textfile:6 fd5d1200-88da-11dd-b7cf-000475e441b9
+finduuid-files/textfile:8 once more 9829C1A8-88D5-11DD-9A24-000475E441B9
 finduuid-files/text2:here 08CCB59A-88E1-11DD-A80C-000475E441B9blabla
 END
     "",
@@ -204,6 +208,38 @@
 );
 
 # }}}
+diag("Testing -u (--unique) option...");
+testcmd("$CMD --unique -l finduuid-files/textfile", # {{{
+    <<END,
+4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
+6 fd5d1200-88da-11dd-b7cf-000475e441b9
+END
+    "",
+    "Print whole line with only one UUID + --unique works",
+);
+
+# }}}
+testcmd("$CMD -u -l <finduuid-files/textfile", # {{{
+    <<END,
+4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
+6 fd5d1200-88da-11dd-b7cf-000475e441b9
+END
+    "",
+    "Read from stdin and print unique uuids",
+);
+
+# }}}
+testcmd("$CMD -u -lf finduuid-files/textfile finduuid-files/text2", # {{{
+    <<END,
+finduuid-files/textfile:4 dfv dsf 9829c1a8-88d5-11dd-9a24-000475e441b9
+finduuid-files/textfile:6 fd5d1200-88da-11dd-b7cf-000475e441b9
+finduuid-files/text2:here 08CCB59A-88E1-11DD-A80C-000475E441B9blabla
+END
+    "",
+    "Print filename and whole line with unique uuids",
+);
+
+# }}}
 diag("Testing -v (--verbose) option...");
 likecmd("$CMD -hv", # {{{
     '/\$Id: .*? \$.*  Show this help\./s',
