#!/usr/bin/perl

# $Id: hf,v 1.8 2000/03/27 00:18:31 sunny Exp $
# Formatterer HTML-source med TAB'er

# Bugs: Hvis start+end-elementer står på samme linje, blir ikke innrykket
# rett. En eller annen rekursiv sjekk på linjene må kanskje gjøres.
# Foreløpig får man sette dem på hver sin linje.

use strict;
# require 'getopts.pl';
# &Getopts('hs');

&print_help() if ($ARGV[0] =~ /^(--help|-h)$/);

$| = 1;

my $Tabs = "";
my $tab_indent = $ARGV[0] >= 0 ? shift : 0;
my $orig_line = "";
my @Elements = (
	"applet", "blockquote", "body", "caption", "center", "colgroup",
	"div", "dl", "form", "frameset", "head", "html", "ol", "map",
	"noframes", "noscript", "select", "script", "style", "table", "td",
	"th", "tr", "ul"
);

for (; $tab_indent; $tab_indent--) {
	$Tabs .= "\t";
}

while (<>) {
	my $Line = $_;
	my $Element = "";
	my $f = "";
	my $out_line;

	# $Line =~ $opt_s ? s/^\s+(.*?)\s+$/$1/ : s/^\t+(.*)/$1/;
	$Line =~ s/^\t+(.*)/$1/;
	for $f (@Elements) {
		if ($Line =~ m!</($f)([ >])!i) { # Hvis end-tag ble funnet...
			$Element = $1;
			$tab_indent--;
			$Tabs =~ s/\t$//;
			# $Line =~ s/($Element)/sprintf("\n%s%s", $Tabs, $1)/gei;
		}
	}
	$out_line = "$Tabs$Line";
	$out_line =~ s/\s+$//g; # Fjern alle whitespace på slutten
	print "$out_line\n";
	for $f (@Elements) {
		if ($Line =~ m!<($f)([ >])!i) { # Hvis begin-tag ble funnet...
			$Element = $1;
			$tab_indent++;
			$Tabs .= "\t";
			# $Line =~ s/($Element)/sprintf("\n%s%s", $Tabs, $1)/gei;
		}
	}
}

#   -s  Split block elements on separate lines (not finished yet)

sub print_help {
	print <<END;

Syntax: $0 [indentval [files ...]]

HTML formatter

indentval er startantall TAB'er. Hvis filnavn skal spesifiseres, bruk 0.

END
	exit(0);
} # print_help()

#### End of file $Id: hf,v 1.8 2000/03/27 00:18:31 sunny Exp $ ####
