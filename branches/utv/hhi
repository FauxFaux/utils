#!/usr/bin/perl -w

#===============================================
# $Id: hhi,v 1.1.2.7 2002/12/03 05:45:22 sunny Exp $
# Html Header Indexer
# Made by Oyvind A. Holm <sunny@sunbase.org>
#===============================================

use strict;

my $last_level = 0;
my @header_num = qw{0};

while (<>) {
	chomp();
	if (!m#<!-- nohhi --># && m#^(.*)<(h)(\d+)(.*?)>(.*)#i) {
		my ($Pref, $H, $header_level, $Elem, $Rest) = ($1, $2, $3, $4, $5);
		if ($header_level > 1) {
			splice(@header_num, $header_level-1) if ($header_level < $last_level);
			$header_num[$header_level-2]++;
			my $tall_str = join(".", @header_num);
			my $name_str = $tall_str;
			$Rest =~ s#^(<a name="h-.*?">|)([\d\s\.]+)(</a>|)(.*)#$2#;
			# ($tall_str .= ".") if ($header_level == 2);
			$_ = "${Pref}<${H}${header_level}${Elem}><a name=\"h-$name_str\">$tall_str</a> $Rest";
			$last_level = $header_level;
		}
	}
	print("$_\n");
}
