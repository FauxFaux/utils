#!/bin/bash

# $Id$
# Mekker ihop ny, fin Vim.

update_vim-clean

echo ======== mincvs_vim
mincvs_vim || { echo "Et eller annet speist skjedde med mincvs_vim. Kreperer." >&2; exit 0; }

vimcompdir=$HOME/src/other/vim/vim
cd $vimcompdir || { echo "cd $vimcompdir; Ånn ðe tryn." >&2; exit 0; }

x_flags="--enable-gui=no --without-x"
vim_size=huge

if [ -e $HOME/.petronas.mrk -o -e $HOME/.vagabond.mrk -o -e $HOME/.solsje.mrk ]; then
	echo ======== Man er på petronas, vagabond eller solsje. Lag lokal vim.
	vimdir=$HOME/local/prg/vim
	[ -e $HOME/.vagabond.mrk ] && vim_size=normal
else
	vimdir=/usr/local/prg/vim
	if [ -e /ba0614-woody.mrk -o -e /carmbb.mrk ]; then
		echo ======== Er på ba0614 eller carmbb, lag feita Vim med X og gode greia
		x_flags="--with-x --enable-gui=gtk"
	fi
fi

echo ======== ./configure --prefix=$vimdir --with-features=$vim_size --enable-multibyte $x_flags
CFLAGS=-g
./configure --prefix=$vimdir --with-features=$vim_size --enable-multibyte $x_flags

echo ======== make
make
echo

if [ -e $HOME/.petronas.mrk -o -e $HOME/.vagabond.mrk -o -e $HOME/.solsje.mrk ]; then
	# installcmd="rm -rf $vimdir && make install"
	echo Vi er på petronas, vagabond eller solsje, så vi nøyer oss med:
else
	# installcmd="su -c \"rm -rf $vimdir && make install\""
	echo Hvis det gikk bra, er det på tide å bli root, og...
fi
echo "cd $vimcompdir && rm -rf $vimdir && make install && cp -vp src/vim $vimdir/bin/"

# echo $installcmd
# echo -n Trykk Enter for å gjøre det, eller CTRL-C for å feige ut...
# read
# $installcmd
